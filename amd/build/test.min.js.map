{"version":3,"sources":["../src/test.js"],"names":["init","content","setupSvg","simulation","generateSimulation","display","on","tick","makeDraggable","svg","document","querySelector","width","parentNode","clientWidth","height","d3","select","attr","dependencies","forceSimulation","nodes","force","forceManyBody","forceLink","edges","id","d","forceCenter","Object","keys","map","x","data","entries","filter","key","value","flatMap","c","target","source","cm","displayEdges","links","displayNodes","selectAll","enter","append","e","y","n","call","drag","event","fx","fy","alpha","restart"],"mappings":"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","sourcesContent":["export const init = (content) => {\n    setupSvg();\n    let simulation = generateSimulation(content);\n    display(simulation);\n    simulation.on('tick', tick);\n    makeDraggable(simulation);\n};\n\n/**\n * Make the svg as wide as the parent, height is width * 0.6, center viewBox.\n */\nfunction setupSvg() {\n    let svg = document.querySelector('svg');\n    let width = svg.parentNode.clientWidth;\n    let height = width * 0.6;\n    d3.select('svg')\n        .attr('width', width)\n        .attr('height', height)\n        .attr('viewBox', -width/2 + ' ' + -height/2 + ' ' + width + ' ' + height);\n}\n\n/**\n * Generate a simulation, using the nodes and edges (links)\n * extracted from json string representing the dependencies between course modules.\n * The nodes are indexed by the course module id.\n * @param {*} dependencies \n * @returns \n */\nfunction generateSimulation(dependencies) {\n    return d3.forceSimulation(nodes(dependencies))\n        .force('charge', d3.forceManyBody())\n        .force('link', d3.forceLink(edges(dependencies)).id(d => d.id))\n        .force('center', d3.forceCenter());\n}\n\n/**\n * Compute the nodes for d3-force as an array of objects {id: cm_id}\n * @param {*} dependencies \n * @returns \n */\nfunction nodes(dependencies) {\n    return Object.keys(dependencies).map(x => {return {id: x}});\n}\n\n/**\n * Compute the edges (links) for d3-force\n * as an array of objects {source: cm_id, target: cm_id}.\n */ \nfunction edges(data) {\n    return Object.entries(data).filter(([key, value]) => value !== null)\n        .flatMap(([key, value]) => {return value.c.map(x => {return {target: key, source: x.cm + ''}})});\n}\n\n/**\n * Use d3 to display nodes and edges (links).\n * @param {*} simulation \n */\nfunction display(simulation) {\n    displayEdges(simulation.force('link').links());\n    displayNodes(simulation.nodes());\n}\n\nfunction displayEdges(edges) {\n    d3.select('svg').selectAll('line').data(edges)\n        .enter().append('line')\n        .attr('stroke', 'lightgray')\n        .attr('x1', e => e.source.x)\n        .attr('y1', e => e.source.y)\n        .attr('x2', e => e.target.x)\n        .attr('y2', e => e.target.y);\n}\n\nfunction displayNodes(nodes) {\n    d3.select('svg').selectAll('circle').data(nodes)\n        .enter().append('circle')\n        .attr('fill', '#00a8d5')\n        .attr('stroke', 'lightgray')\n        .attr('r', 5)\n        .attr('cx', n => n.x)\n        .attr('cy', n => n.y);\n}\n\n/**\n * Update the simulation.\n */\nfunction tick() {\n    d3.select('svg').selectAll('circle')\n        .attr('cx', n => n.x)\n        .attr('cy', n => n.y);\n    d3.select('svg').selectAll('line')\n        .attr('x1', e => e.source.x)\n        .attr('y1', e => e.source.y)\n        .attr('x2', e => e.target.x)\n        .attr('y2', e => e.target.y);\n}\n\nfunction makeDraggable(simulation) {\n    d3.select('svg').selectAll('circle')\n        .call(d3.drag().on('drag',\n            (event, n) => {\n                n.fx = event.x;\n                n.fy = event.y;\n                simulation.alpha(1).restart();\n            }))\n}\n\n"],"file":"test.min.js"}