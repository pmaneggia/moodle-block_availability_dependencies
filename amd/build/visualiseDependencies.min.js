define ("block_availability_dependencies/visualiseDependencies",["exports","core/ajax"],function(a,b){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=function(a){return a&&a.__esModule?a:{default:a}}(b);var s=function(a,d){d=d;var h=b.default.call([{methodname:"block_availability_dependencies_fetch_course_modules_with_names_and_dependencies",args:{courseid:a}}]);h[0].fail(function(a){return console.log(a)}).then(function(a){var b=e();c(b);a.forEach(function(a){a.depend=JSON.parse(a.depend)});var h;if("no"===d){h=f(a,b);j(h)}else{h=g(a);k(h)}p();h.on("tick",q);r(h)})};a.init=s;var t="#364958",u="#516E84",v=50,w=20,x;function c(a){d3.select("svg.availability_dependencies").attr("width",a.width).attr("height",a.height).attr("viewBox",-a.width/2+" "+-a.height/2+" "+a.width+" "+a.height);d()}function d(){var a=d3.select("svg.availability_dependencies").append("defs");a.append("marker").attr("id","arrow").attr("viewBox","0 0 10 10").attr("refX",15).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",6).attr("markerHeight",8).attr("orient","auto").append("path").attr("fill",u).attr("d","M 0 0 L 10 5 L 0 10 z");a.append("marker").attr("id","arrowToActivity").attr("viewBox","0 0 10 10").attr("refX",30).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",6).attr("markerHeight",8).attr("orient","auto").append("path").attr("fill",u).attr("d","M 0 0 L 10 5 L 0 10 z");a.append("marker").attr("id","arrowToOperator").attr("viewBox","0 0 10 10").attr("refX",18).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",6).attr("markerHeight",8).attr("orient","auto").append("path").attr("fill",u).attr("d","M 0 0 L 10 5 L 0 10 z")}function e(){var a=document.querySelector("svg.availability_dependencies"),b=a.parentNode.clientWidth,c=.6*b;x=b;return{width:b,height:c}}function f(a){return d3.forceSimulation(a).force("x0",d3.forceX()).force("y0",d3.forceY()).force("collide",d3.forceCollide().radius(20)).force("charge",d3.forceManyBody().strength(-300)).force("link",d3.forceLink(h(a)).distance(200).id(function(a){return a.id}))}function g(a){var b=i(a),c=b.edges,d=b.nodes;return d3.forceSimulation(d).force("x0",d3.forceX()).force("y0",d3.forceY()).force("isSource",d3.forceX(-x/3).strength(function(a){return a.isSource})).force("isTarget",d3.forceX(x/3).strength(function(a){return a.isTarget})).force("collide",d3.forceCollide(100).radius(function(a){return("activity"===a.genus?v:w)+30})).force("charge",d3.forceManyBody().strength(-300)).force("link",d3.forceLink(c).distance(50).id(function(a){return a.id}))}function h(a){var b=function(a){return a.c.flatMap(function(a){return a.op?b(a):"completion"===a.type?a.cm:[]})};return a.filter(function(a){var b=a.id,c=a.name,d=a.depend,e=a.predecessor;return null!==d}).map(function(a){var c=a.id,d=a.name,e=a.depend,f=a.predecessor;return b(e).map(function(a){return{target:c,source:-1===a?f:a,name:d}})}).flat()}function i(a){var d=0;function b(){return"uid_"+d++}var e=[],f=function(a){return a.map(function(a){return{id:a.id,name:a.name,genus:"activity",isSource:0,isTarget:0}})}(a);function c(a,d,g,h){g.forEach(function(g){if(g.op){var i={id:b(),name:g.op,genus:"operator",isTarget:.1,isSource:.1};f.push(i);var j={target:a,source:i.id,toGenus:d};e.push(j);c(i.id,"operator",g.c,h)}else if("completion"===g.type){var k={target:a,source:-1===g.cm?h:g.cm,toGenus:d};f.find(function(a){return a.id===k.source}).isSource+=.2;e.push(k)}})}a.forEach(function(b){if(null!==b.depend){f.find(function(a){return a.id==b.id}).isTarget=.9;c(b.id,"activity",[b.depend],b.predecessor)}});return{edges:e,nodes:f}}function j(a){l(a.force("link").links());n(a.nodes())}function k(a){m(a.force("link").links());o(a.nodes())}function l(a){d3.select("svg").append("g").selectAll("line").data(a).enter().append("line").attr("stroke",u).attr("stroke-width","3px").attr("stroke-linecap","round").attr("marker-end","url(#arrow)")}function m(a){d3.select("svg").append("g").selectAll("line").data(a).enter().append("line").attr("stroke",t).attr("stroke-opacity",.7).attr("stroke-width","4px").attr("stroke-linecap","round").attr("marker-end",function(a){return"activity"===a.toGenus?"url(#arrowToActivity":"url(#arrowToOperator"})}function n(a){d3.select("svg").append("g").selectAll("circle").data(a).join("circle").attr("fill","#9BD1E5").attr("stroke","white").attr("r",10);d3.select("svg").append("g").selectAll("text").data(a).join("text").attr("fill",t).attr("font-family","sans-serif").attr("font-weight","bold").clone().lower().attr("stroke","white").attr("stroke-width",4).attr("stroke-opacity",.5)}function o(a){d3.select("svg").append("g").selectAll("circle").data(a).join("circle").attr("fill",function(a){return"activity"===a.genus?"#9BD1E5":"&"===a.name?"#FFB400":"|"===a.name?"#CEFF1A":"#D1FAFF"}).attr("stroke","white").attr("stroke-width",3).attr("r",function(a){return"activity"===a.genus?v:w});d3.select("svg").append("g").selectAll("text").data(a).join("text").attr("fill",t).attr("font-family","sans-serif").attr("font-weight","bold").attr("text-anchor","middle").attr("dx",-5).attr("dominant-baseline","middle").attr("dy",5)}var y,z,A;function p(){y=d3.select("svg").selectAll("line");z=d3.select("svg").selectAll("circle");A=d3.select("svg").selectAll("text")}function q(){z.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y});y.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y});A.attr("x",function(a){return a.x+5}).attr("y",function(a){return a.y-5}).text(function(a){return a.name})}function r(a){z.call(d3.drag().on("start",function(b,c){if(!b.active)a.alphaTarget(.3).restart();c.fx=b.x;c.fy=b.y}).on("drag",function(a,b){b.fx=a.x;b.fy=a.y}).on("end",function(b){if(!b.active)a.alphaTarget(0)}))}});
//# sourceMappingURL=visualiseDependencies.min.js.map
