define ("block_availability_dependencies/visualiseDependencies",["exports","core/ajax"],function(a,b){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=function(a){return a&&a.__esModule?a:{default:a}}(b);var l=function(a){c();var e=b.default.call([{methodname:"block_availability_dependencies_fetch_course_modules_with_names_and_dependencies",args:{courseid:a}}]);e[0].fail(function(a){return console.log(a)}).then(function(a){a.forEach(function(a){a.dep=JSON.parse(a.dep)});var b=d(a);f(b);i();b.on("tick",j);k(b)})};a.init=l;function c(){var a=document.querySelector("svg"),b=a.parentNode.clientWidth,c=.6*b;d3.select("svg").attr("width",b).attr("height",c).attr("viewBox",-b/2+" "+-c/2+" "+b+" "+c)}function d(a){return d3.forceSimulation(a).force("charge",d3.forceManyBody().strength(-300)).force("link",d3.forceLink(e(a)).id(function(a){return a.id})).force("center",d3.forceCenter())}function e(a){return a.filter(function(a){var b=a.id,c=a.name,d=a.dep;return null!==d}).flatMap(function(a){var b=a.id,c=a.name,d=a.dep;return d.c.filter(function(a){return"completion"==a.type}).map(function(a){return{target:b,source:a.cm,op:a.op}})})}function f(a){g(a.force("link").links());h(a.nodes())}function g(a){d3.select("svg g").selectAll("line").data(a).enter().append("line").attr("stroke","lightgray").attr("stroke-width","2px").attr("stroke-dasharray",function(a){return"&"==a.op?"0 0":"|"==a.op?"2 2":"7 2 2 2"}).attr("marker-end","url(#arrow)")}function h(a){d3.select("svg g").selectAll("circle").data(a).join("circle").attr("fill","#00a8d5").attr("stroke","white").attr("r",5);d3.select("svg g").selectAll("text").data(a).join("text").attr("fill","darkgray").attr("font-family","sans-serif").attr("font-weight","bold").attr("font-size","small")}var m,n,o;function i(){m=d3.select("svg g").selectAll("line");n=d3.select("svg g").selectAll("circle");o=d3.select("svg g").selectAll("text")}function j(){n.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y});m.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y});o.attr("x",function(a){return a.x+5}).attr("y",function(a){return a.y-5}).text(function(a){return a.name})}function k(a){n.call(d3.drag().on("drag",function(b,c){c.fx=b.x;c.fy=b.y;a.alpha(1).restart()}))}});
//# sourceMappingURL=visualiseDependencies.min.js.map
